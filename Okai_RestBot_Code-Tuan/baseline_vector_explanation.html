<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baseline Vector Method</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 40px;
            font-size: 1.2em;
        }
        
        .section {
            margin-bottom: 40px;
            padding: 30px;
            background: #f8f9ff;
            border-radius: 15px;
            border-left: 5px solid #667eea;
        }
        
        h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
        }
        
        h3 {
            color: #764ba2;
            margin: 20px 0 10px 0;
            font-size: 1.3em;
        }
        
        .canvas-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        canvas {
            display: block;
            margin: 0 auto;
            border: 2px solid #ddd;
            border-radius: 8px;
        }
        
        .formula {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 1.1em;
            border-left: 4px solid #764ba2;
            overflow-x: auto;
        }
        
        .key-point {
            background: #fff4e6;
            padding: 15px 20px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #ff9800;
        }
        
        .key-point strong {
            color: #e65100;
        }
        
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .comparison-item {
            padding: 20px;
            border-radius: 10px;
        }
        
        .comparison-item.wrong {
            background: #ffebee;
            border: 2px solid #f44336;
        }
        
        .comparison-item.correct {
            background: #e8f5e9;
            border: 2px solid #4caf50;
        }
        
        .comparison-item h4 {
            margin-bottom: 10px;
        }
        
        .wrong h4 {
            color: #c62828;
        }
        
        .correct h4 {
            color: #2e7d32;
        }
        
        ul {
            margin: 15px 0;
            padding-left: 30px;
        }
        
        li {
            margin: 10px 0;
            line-height: 1.6;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 20px 0;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .info-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .step {
            background: white;
            padding: 20px;
            margin: 15px 0;
            border-radius: 10px;
            border-left: 5px solid #667eea;
        }
        
        .step-number {
            display: inline-block;
            background: #667eea;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            font-weight: bold;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìê Baseline Vector Method</h1>
        <p class="subtitle">Ph∆∞∆°ng ph√°p t√≠nh Heading t·ª´ 2 Tag UWB</p>
        
        <!-- SECTION 1: Kh√°i ni·ªám -->
        <div class="section">
            <h2>üéØ 1. Baseline Vector l√† g√¨?</h2>
            
            <div class="key-point">
                <strong>ƒê·ªãnh nghƒ©a:</strong> Baseline Vector l√† <strong>vector n·ªëi gi·ªØa 2 Tag UWB</strong> ƒë∆∞·ª£c g·∫Øn c·ªë ƒë·ªãnh tr√™n c√πng m·ªôt v·∫≠t th·ªÉ (robot, xe, drone...).
            </div>
            
            <div class="canvas-container">
                <canvas id="conceptCanvas" width="700" height="400"></canvas>
            </div>
            
            <ul>
                <li><strong>Tag 5 (Tr∆∞·ªõc):</strong> G·∫Øn ·ªü ph√≠a tr∆∞·ªõc robot - d√πng l√†m ƒëi·ªÉm tham chi·∫øu ch√≠nh</li>
                <li><strong>Tag 6 (Sau):</strong> G·∫Øn ·ªü ph√≠a sau robot - c√°ch Tag 5 m·ªôt kho·∫£ng c·ªë ƒë·ªãnh L</li>
                <li><strong>Baseline = Vector t·ª´ Tag 5 ‚Üí Tag 6</strong></li>
                <li><strong>Heading = H∆∞·ªõng c·ªßa Baseline + 180¬∞</strong> (v√¨ baseline h∆∞·ªõng v·ªÅ ph√≠a sau)</li>
            </ul>
        </div>
        
        <!-- SECTION 2: T·∫°i sao d√πng Baseline Vector? -->
        <div class="section">
            <h2>üí° 2. T·∫°i sao d√πng Baseline Vector?</h2>
            
            <div class="comparison">
                <div class="comparison-item wrong">
                    <h4>‚ùå Ph∆∞∆°ng ph√°p C≈® (Sai)</h4>
                    <div class="formula">cos(Œ±) = ŒîR / L<br>H = angle_to_anchor - Œ±</div>
                    <ul>
                        <li>Ch·ªâ d√πng 1 th√¥ng tin: hi·ªáu kho·∫£ng c√°ch ŒîR</li>
                        <li>M·∫•t th√¥ng tin th√†nh ph·∫ßn vu√¥ng g√≥c</li>
                        <li>Kh√¥ng c√≥ c∆° s·ªü h√¨nh h·ªçc r√µ r√†ng</li>
                        <li>K·∫øt qu·∫£ kh√¥ng ·ªïn ƒë·ªãnh</li>
                    </ul>
                </div>
                
                <div class="comparison-item correct">
                    <h4>‚úÖ Baseline Vector (ƒê√∫ng)</h4>
                    <div class="formula">Baseline = (parallel, perpendicular)<br>H = atan2(baseline) + 180¬∞</div>
                    <ul>
                        <li>D√πng ƒë·∫ßy ƒë·ªß 2 th√†nh ph·∫ßn vector</li>
                        <li>C√≥ c∆° s·ªü to√°n h·ªçc v·ªØng ch·∫Øc</li>
                        <li>K·∫øt qu·∫£ ch√≠nh x√°c v√† ·ªïn ƒë·ªãnh</li>
                        <li>ƒê∆∞·ª£c d√πng trong GPS RTK, UAV...</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- SECTION 3: To√°n h·ªçc -->
        <div class="section">
            <h2>üìä 3. To√°n h·ªçc ƒë·∫±ng sau Baseline Vector</h2>
            
            <h3>B∆∞·ªõc 1: Ph√¢n t√≠ch Vector Baseline</h3>
            <div class="canvas-container">
                <canvas id="mathCanvas" width="700" height="400"></canvas>
            </div>
            
            <p>Baseline vector <strong>B</strong> c√≥ th·ªÉ ph√¢n t√≠ch th√†nh 2 th√†nh ph·∫ßn:</p>
            
            <div class="formula">
                <strong>Th√†nh ph·∫ßn Song song (Parallel):</strong><br>
                B_parallel = (R1 - R2) √ó √ª_anchor<br>
                <br>
                <strong>Th√†nh ph·∫ßn Vu√¥ng g√≥c (Perpendicular):</strong><br>
                B_perp = ¬±‚àö(L¬≤ - (R1-R2)¬≤) √ó √ª_perp<br>
                <br>
                <strong>Baseline t·ªïng:</strong><br>
                B = B_parallel + B_perp
            </div>
            
            <div class="key-point">
                <strong>Quan tr·ªçng:</strong> D·∫•u ¬± c·ªßa th√†nh ph·∫ßn vu√¥ng g√≥c t·∫°o ra 2 candidate. Ta ph·∫£i ch·ªçn candidate n√†o kh·ªõp v·ªõi kho·∫£ng c√°ch R2 th·ª±c t·∫ø!
            </div>
            
            <h3>B∆∞·ªõc 2: T√≠nh Heading</h3>
            <div class="formula">
                baseline_angle = atan2(B.x, B.y) √ó 180/œÄ<br>
                <br>
                <strong>Heading = baseline_angle + 180¬∞</strong><br>
                <em>(V√¨ baseline h∆∞·ªõng v·ªÅ ph√≠a SAU, heading h∆∞·ªõng v·ªÅ ph√≠a TR∆Ø·ªöC)</em>
            </div>
        </div>
        
        <!-- SECTION 4: Thu·∫≠t to√°n -->
        <div class="section">
            <h2>‚öôÔ∏è 4. Thu·∫≠t to√°n t·ª´ng b∆∞·ªõc</h2>
            
            <div class="step">
                <span class="step-number">1</span>
                <strong>L·∫•y d·ªØ li·ªáu:</strong> D1, D2 (kho·∫£ng c√°ch 3D), L (chi·ªÅu d√†i baseline), v·ªã tr√≠ robot v√† anchor
            </div>
            
            <div class="step">
                <span class="step-number">2</span>
                <strong>Lo·∫°i b·ªè th√†nh ph·∫ßn Z:</strong> R1 = ‚àö(D1¬≤ - dZ¬≤), R2 = ‚àö(D2¬≤ - dZ¬≤)
            </div>
            
            <div class="step">
                <span class="step-number">3</span>
                <strong>T√≠nh vector ƒë·∫øn anchor:</strong> √ª_anchor = (anchor - robot) / |anchor - robot|
            </div>
            
            <div class="step">
                <span class="step-number">4</span>
                <strong>T√≠nh 2 th√†nh ph·∫ßn:</strong>
                <ul>
                    <li>Parallel: ŒîR = R1 - R2</li>
                    <li>Perpendicular: ‚àö(L¬≤ - ŒîR¬≤)</li>
                </ul>
            </div>
            
            <div class="step">
                <span class="step-number">5</span>
                <strong>T·∫°o 2 candidates:</strong> baseline_1 v√† baseline_2 (v·ªõi d·∫•u ¬± c·ªßa perpendicular)
            </div>
            
            <div class="step">
                <span class="step-number">6</span>
                <strong>Ch·ªçn candidate ƒë√∫ng:</strong> T√≠nh v·ªã tr√≠ Tag 6 t·ª´ m·ªói candidate, ch·ªçn candidate c√≥ kho·∫£ng c√°ch ƒë·∫øn anchor g·∫ßn R2 nh·∫•t
            </div>
            
            <div class="step">
                <span class="step-number">7</span>
                <strong>T√≠nh heading:</strong> H = atan2(baseline.x, baseline.y) √ó 180/œÄ + 180¬∞
            </div>
        </div>
        
        <!-- SECTION 5: Demo -->
        <div class="section">
            <h2>üéÆ 5. Demo T∆∞∆°ng T√°c</h2>
            
            <div class="info-box">
                <strong>H∆∞·ªõng d·∫´n:</strong> Nh·∫•n c√°c n√∫t ƒë·ªÉ xem robot quay v√† Baseline Vector thay ƒë·ªïi
            </div>
            
            <div class="controls">
                <button onclick="setHeading(0)">H∆∞·ªõng B·∫Øc (0¬∞)</button>
                <button onclick="setHeading(90)">H∆∞·ªõng ƒê√¥ng (90¬∞)</button>
                <button onclick="setHeading(180)">H∆∞·ªõng Nam (180¬∞)</button>
                <button onclick="setHeading(270)">H∆∞·ªõng T√¢y (270¬∞)</button>
                <button onclick="animateRotation()">üîÑ Quay li√™n t·ª•c</button>
            </div>
            
            <div class="canvas-container">
                <canvas id="demoCanvas" width="700" height="500"></canvas>
            </div>
            
            <div id="output" style="text-align: center; margin-top: 20px; font-size: 1.2em; color: #667eea; font-weight: bold;"></div>
        </div>
        
        <!-- SECTION 6: ·ª®ng d·ª•ng -->
        <div class="section">
            <h2>üöÄ 6. ·ª®ng d·ª•ng th·ª±c t·∫ø</h2>
            
            <ul>
                <li><strong>Robot t·ª± h√†nh:</strong> X√°c ƒë·ªãnh h∆∞·ªõng ch√≠nh x√°c ƒë·ªÉ ƒëi·ªÅu khi·ªÉn</li>
                <li><strong>Drone/UAV:</strong> GPS RTK dual-antenna heading</li>
                <li><strong>T√†u th·ªßy:</strong> H·ªá th·ªëng ƒë·ªãnh v·ªã GPS GNSS</li>
                <li><strong>Xe t·ª± l√°i:</strong> X√°c ƒë·ªãnh heading khi ƒë·ª©ng y√™n (IMU kh√¥ng ho·∫°t ƒë·ªông)</li>
                <li><strong>Kh·∫£o s√°t:</strong> Total station, LiDAR orientation</li>
            </ul>
        </div>
    </div>
    
    <script>
        // ===== CANVAS 1: Concept =====
        const ctx1 = document.getElementById('conceptCanvas').getContext('2d');
        
        function drawConcept() {
            ctx1.clearRect(0, 0, 700, 400);
            
            // Draw anchor
            ctx1.fillStyle = '#f44336';
            ctx1.beginPath();
            ctx1.arc(550, 100, 15, 0, Math.PI * 2);
            ctx1.fill();
            ctx1.fillStyle = '#000';
            ctx1.font = 'bold 16px Arial';
            ctx1.fillText('Anchor', 510, 80);
            
            // Draw robot
            const robotX = 200;
            const robotY = 250;
            const L = 80; // Baseline length
            
            // Tag 5 (front)
            ctx1.fillStyle = '#4caf50';
            ctx1.beginPath();
            ctx1.arc(robotX, robotY - L/2, 12, 0, Math.PI * 2);
            ctx1.fill();
            ctx1.fillStyle = '#000';
            ctx1.fillText('Tag 5 (Tr∆∞·ªõc)', robotX + 20, robotY - L/2 - 10);
            
            // Tag 6 (back)
            ctx1.fillStyle = '#2196f3';
            ctx1.beginPath();
            ctx1.arc(robotX, robotY + L/2, 12, 0, Math.PI * 2);
            ctx1.fill();
            ctx1.fillText('Tag 6 (Sau)', robotX + 20, robotY + L/2 + 20);
            
            // Baseline vector
            ctx1.strokeStyle = '#9c27b0';
            ctx1.lineWidth = 3;
            ctx1.beginPath();
            ctx1.moveTo(robotX, robotY - L/2);
            ctx1.lineTo(robotX, robotY + L/2);
            ctx1.stroke();
            
            // Arrow
            ctx1.beginPath();
            ctx1.moveTo(robotX, robotY + L/2);
            ctx1.lineTo(robotX - 8, robotY + L/2 - 15);
            ctx1.lineTo(robotX + 8, robotY + L/2 - 15);
            ctx1.closePath();
            ctx1.fillStyle = '#9c27b0';
            ctx1.fill();
            
            ctx1.fillStyle = '#9c27b0';
            ctx1.font = 'bold 14px Arial';
            ctx1.fillText('Baseline Vector', robotX - 100, robotY);
            ctx1.fillText('L = ' + (L/10).toFixed(1) + 'm', robotX - 50, robotY + 5);
            
            // Distance lines
            ctx1.strokeStyle = '#ff9800';
            ctx1.setLineDash([5, 5]);
            ctx1.lineWidth = 2;
            
            ctx1.beginPath();
            ctx1.moveTo(robotX, robotY - L/2);
            ctx1.lineTo(550, 100);
            ctx1.stroke();
            ctx1.fillStyle = '#ff9800';
            ctx1.font = '14px Arial';
            ctx1.fillText('D1', 350, 150);
            
            ctx1.beginPath();
            ctx1.moveTo(robotX, robotY + L/2);
            ctx1.lineTo(550, 100);
            ctx1.stroke();
            ctx1.fillText('D2', 350, 200);
            
            ctx1.setLineDash([]);
            
            // Heading arrow
            ctx1.strokeStyle = '#ff5722';
            ctx1.fillStyle = '#ff5722';
            ctx1.lineWidth = 4;
            ctx1.beginPath();
            ctx1.moveTo(robotX, robotY - L/2);
            ctx1.lineTo(robotX, robotY - L/2 - 80);
            ctx1.stroke();
            
            ctx1.beginPath();
            ctx1.moveTo(robotX, robotY - L/2 - 80);
            ctx1.lineTo(robotX - 10, robotY - L/2 - 65);
            ctx1.lineTo(robotX + 10, robotY - L/2 - 65);
            ctx1.closePath();
            ctx1.fill();
            
            ctx1.fillText('HEADING', robotX + 15, robotY - L/2 - 70);
            ctx1.fillText('(H∆∞·ªõng robot)', robotX + 15, robotY - L/2 - 55);
        }
        
        drawConcept();
        
        // ===== CANVAS 2: Math =====
        const ctx2 = document.getElementById('mathCanvas').getContext('2d');
        
        function drawMath() {
            ctx2.clearRect(0, 0, 700, 400);
            
            const originX = 150;
            const originY = 300;
            const anchorX = 500;
            const anchorY = 100;
            
            // Anchor
            ctx2.fillStyle = '#f44336';
            ctx2.beginPath();
            ctx2.arc(anchorX, anchorY, 12, 0, Math.PI * 2);
            ctx2.fill();
            ctx2.fillStyle = '#000';
            ctx2.font = 'bold 14px Arial';
            ctx2.fillText('Anchor', anchorX - 30, anchorY - 20);
            
            // Robot (Tag 5)
            ctx2.fillStyle = '#4caf50';
            ctx2.beginPath();
            ctx2.arc(originX, originY, 10, 0, Math.PI * 2);
            ctx2.fill();
            ctx2.fillText('Tag 5', originX - 40, originY);
            
            // Vector to anchor
            ctx2.strokeStyle = '#ff9800';
            ctx2.lineWidth = 2;
            ctx2.beginPath();
            ctx2.moveTo(originX, originY);
            ctx2.lineTo(anchorX, anchorY);
            ctx2.stroke();
            
            const dx = anchorX - originX;
            const dy = anchorY - originY;
            const dist = Math.sqrt(dx*dx + dy*dy);
            const ux = dx / dist;
            const uy = dy / dist;
            
            // Parallel component
            const parallel = 60;
            ctx2.strokeStyle = '#2196f3';
            ctx2.lineWidth = 3;
            ctx2.beginPath();
            ctx2.moveTo(originX, originY);
            ctx2.lineTo(originX + ux * parallel, originY + uy * parallel);
            ctx2.stroke();
            ctx2.fillStyle = '#2196f3';
            ctx2.fillText('Parallel (ŒîR)', originX + ux * parallel/2 - 20, originY + uy * parallel/2 + 20);
            
            // Perpendicular component
            const perpX = -uy;
            const perpY = ux;
            const perpLen = 50;
            ctx2.strokeStyle = '#9c27b0';
            ctx2.beginPath();
            ctx2.moveTo(originX + ux * parallel, originY + uy * parallel);
            ctx2.lineTo(originX + ux * parallel + perpX * perpLen, originY + uy * parallel + perpY * perpLen);
            ctx2.stroke();
            ctx2.fillStyle = '#9c27b0';
            ctx2.fillText('Perpendicular', originX + ux * parallel + perpX * perpLen/2 - 50, originY + uy * parallel + perpY * perpLen/2 - 10);
            
            // Baseline (total)
            const baseX = ux * parallel + perpX * perpLen;
            const baseY = uy * parallel + perpY * perpLen;
            ctx2.strokeStyle = '#4caf50';
            ctx2.lineWidth = 4;
            ctx2.beginPath();
            ctx2.moveTo(originX, originY);
            ctx2.lineTo(originX + baseX, originY + baseY);
            ctx2.stroke();
            
            // Arrow
            const angle = Math.atan2(baseY, baseX);
            ctx2.fillStyle = '#4caf50';
            ctx2.beginPath();
            ctx2.moveTo(originX + baseX, originY + baseY);
            ctx2.lineTo(originX + baseX - 12*Math.cos(angle-0.3), originY + baseY - 12*Math.sin(angle-0.3));
            ctx2.lineTo(originX + baseX - 12*Math.cos(angle+0.3), originY + baseY - 12*Math.sin(angle+0.3));
            ctx2.closePath();
            ctx2.fill();
            
            ctx2.font = 'bold 16px Arial';
            ctx2.fillText('BASELINE', originX + baseX/2 - 40, originY + baseY/2 + 40);
            
            // Tag 6
            ctx2.fillStyle = '#2196f3';
            ctx2.beginPath();
            ctx2.arc(originX + baseX, originY + baseY, 10, 0, Math.PI * 2);
            ctx2.fill();
            ctx2.fillStyle = '#000';
            ctx2.font = 'bold 14px Arial';
            ctx2.fillText('Tag 6', originX + baseX + 15, originY + baseY);
        }
        
        drawMath();
        
        // ===== CANVAS 3: Interactive Demo =====
        const ctx3 = document.getElementById('demoCanvas').getContext('2d');
        let currentHeading = 0;
        let animating = false;
        
        function drawDemo(heading) {
            ctx3.clearRect(0, 0, 700, 500);
            
            // Grid
            ctx3.strokeStyle = '#e0e0e0';
            ctx3.lineWidth = 1;
            for (let i = 0; i < 700; i += 50) {
                ctx3.beginPath();
                ctx3.moveTo(i, 0);
                ctx3.lineTo(i, 500);
                ctx3.stroke();
            }
            for (let i = 0; i < 500; i += 50) {
                ctx3.beginPath();
                ctx3.moveTo(0, i);
                ctx3.lineTo(700, i);
                ctx3.stroke();
            }
            
            // Compass
            ctx3.fillStyle = '#666';
            ctx3.font = 'bold 16px Arial';
            ctx3.fillText('N', 345, 30);
            ctx3.fillText('E', 670, 255);
            ctx3.fillText('S', 345, 480);
            ctx3.fillText('W', 20, 255);
            
            // Anchor
            const anchorX = 550;
            const anchorY = 150;
            ctx3.fillStyle = '#f44336';
            ctx3.beginPath();
            ctx3.arc(anchorX, anchorY, 15, 0, Math.PI * 2);
            ctx3.fill();
            ctx3.fillStyle = '#fff';
            ctx3.font = 'bold 12px Arial';
            ctx3.fillText('A', anchorX - 5, anchorY + 5);
            
            // Robot center
            const robotX = 300;
            const robotY = 350;
            const L = 60; // Baseline length in pixels
            
            // Convert heading to radians (0¬∞ = North = -Y direction)
            const headingRad = (heading - 90) * Math.PI / 180;
            
            // Tag positions
            const tag5X = robotX + Math.cos(headingRad) * L/2;
            const tag5Y = robotY + Math.sin(headingRad) * L/2;
            const tag6X = robotX - Math.cos(headingRad) * L/2;
            const tag6Y = robotY - Math.sin(headingRad) * L/2;
            
            // Draw baseline
            ctx3.strokeStyle = '#9c27b0';
            ctx3.lineWidth = 4;
            ctx3.beginPath();
            ctx3.moveTo(tag5X, tag5Y);
            ctx3.lineTo(tag6X, tag6Y);
            ctx3.stroke();
            
            // Draw robot body
            ctx3.fillStyle = 'rgba(0, 150, 136, 0.3)';
            ctx3.beginPath();
            ctx3.arc(robotX, robotY, L/2 + 10, 0, Math.PI * 2);
            ctx3.fill();
            
            // Tag 5
            ctx3.fillStyle = '#4caf50';
            ctx3.beginPath();
            ctx3.arc(tag5X, tag5Y, 12, 0, Math.PI * 2);
            ctx3.fill();
            ctx3.fillStyle = '#fff';
            ctx3.font = 'bold 10px Arial';
            ctx3.fillText('5', tag5X - 4, tag5Y + 4);
            
            // Tag 6
            ctx3.fillStyle = '#2196f3';
            ctx3.beginPath();
            ctx3.arc(tag6X, tag6Y, 12, 0, Math.PI * 2);
            ctx3.fill();
            ctx3.fillStyle = '#fff';
            ctx3.fillText('6', tag6X - 4, tag6Y + 4);
            
            // Heading arrow
            ctx3.strokeStyle = '#ff5722';
            ctx3.fillStyle = '#ff5722';
            ctx3.lineWidth = 5;
            const arrowLen = 80;
            const arrowEndX = tag5X + Math.cos(headingRad) * arrowLen;
            const arrowEndY = tag5Y + Math.sin(headingRad) * arrowLen;
            
            ctx3.beginPath();
            ctx3.moveTo(tag5X, tag5Y);
            ctx3.lineTo(arrowEndX, arrowEndY);
            ctx3.stroke();
            
            ctx3.beginPath();
            ctx3.moveTo(arrowEndX, arrowEndY);
            ctx3.lineTo(arrowEndX - 15*Math.cos(headingRad - 0.4), arrowEndY - 15*Math.sin(headingRad - 0.4));
            ctx3.lineTo(arrowEndX - 15*Math.cos(headingRad + 0.4), arrowEndY - 15*Math.sin(headingRad + 0.4));
            ctx3.closePath();
            ctx3.fill();
            
            // Distance lines
            ctx3.strokeStyle = '#ff9800';
            ctx3.setLineDash([5, 5]);
            ctx3.lineWidth = 2;
            
            ctx3.beginPath();
            ctx3.moveTo(tag5X, tag5Y);
            ctx3.lineTo(anchorX, anchorY);
            ctx3.stroke();
            
            const d1 = Math.sqrt((anchorX - tag5X)**2 + (anchorY - tag5Y)**2) / 50;
            
            ctx3.beginPath();
            ctx3.moveTo(tag6X, tag6Y);
            ctx3.lineTo(anchorX, anchorY);
            ctx3.stroke();
            
            const d2 = Math.sqrt((anchorX - tag6X)**2 + (anchorY - tag6Y)**2) / 50;
            
            ctx3.setLineDash([]);
            
            // Labels
            ctx3.fillStyle = '#ff9800';
            ctx3.font = 'bold 14px Arial';
            ctx3.fillText('D1=' + d1.toFixed(2) + 'm', (tag5X + anchorX)/2 - 30, (tag5Y + anchorY)/2 - 10);
            ctx3.fillText('D2=' + d2.toFixed(2) + 'm', (tag6X + anchorX)/2 - 30, (tag6Y + anchorY)/2 + 20);
            
            // Heading value
            ctx3.fillStyle = '#ff5722';
            ctx3.font = 'bold 20px Arial';
            ctx3.fillText('Heading: ' + heading.toFixed(0) + '¬∞', robotX - 50, robotY - 60);
            
            // Baseline angle
            const baselineAngle = Math.atan2(tag6X - tag5X, tag5Y - tag6Y) * 180 / Math.PI;
            ctx3.fillStyle = '#9c27b0';
            ctx3.fillText('Baseline: ' + ((baselineAngle + 360) % 360).toFixed(0) + '¬∞', robotX - 60, robotY - 80);
            
            // Output info
            document.getElementById('output').innerHTML = 
                `D1=${d1.toFixed(2)}m | D2=${d2.toFixed(2)}m | ŒîR=${(d1-d2).toFixed(3)}m | Heading=${heading.toFixed(0)}¬∞`;
        }
        
        function setHeading(h) {
            animating = false;
            currentHeading = h;
            drawDemo(h);
        }
        
        function animateRotation() {
            animating = true;
            animate();
        }
        
        function animate() {
            if (!animating) return;
            currentHeading = (currentHeading + 2) % 360;
            drawDemo(currentHeading);
            requestAnimationFrame(animate);
        }
        
        // Initial draw
        drawDemo(0);
    </script>
</body>
</html>
            